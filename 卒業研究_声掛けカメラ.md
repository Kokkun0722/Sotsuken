# 従来の徘徊センサ

## 違和感を感じにくい
## 部屋に溶け込む
## スマホへの通知

### 家族が四六時中監視しなくていい
### 部屋に鍵を掛けなくていい
### 通知後は全て家族任せ

#### 家族がいなかったら老人が一人で外出してしまう
#### 介護専用の人がいても気づかない

### 誰も見ていなければ、徘徊を止めることができない

#### 誰か外出を止めてほしい
#### 他人が来るまで時間稼ぎをしてほしい
#### どこに行ったかを教えてほしい



# 声掛けスマートカメラ

## 目的

### 老人が外に出たら声を掛ける

#### 外に出ようとしたことを通知
#### 会話内容を記録
#### 外に出たかどうかをスマホ（LINE）に知らせる

### 耳が遠い老人に声を掛けたい

#### ジェスチャー

## 前提

### 玄関に置く

## ハード

### ラズパイ・Arduino・バッテリーが入るサイズ - 110×110×110以上
### 棚・床に置けるサイズ - 160×160×300未満
### サイズの条件を満たすため、Qumcumを参考にする

## ソフト

### 動体検知システム

#### 差分検知

##### 背景の明るさの変化に反応した（照明・カーテン）
##### 振動にも反応した
##### 背景・振動の誤認識を防ぎ、人間の動きのみを検知したい
##### チャタリングのように、n秒間認識し続けたらフラグをオンにする操作をすると、外光を誤検出しなくなった。
###### 人間の動作は2秒以上かかるが、照明や外光の変化は1秒未満。

#### 前画像と今画像で明度を揃える

##### 太陽光などの光に関わるノイズを消したかった。
##### 明るいなら暗く、くらいなら明るく調整した
##### しかし、相対的な明度は変わらなかったために影を認識してしまい、照明のノイズを誤認識した。

#### 背景除去

##### 背景を消し、人間のシルエットの差分を検知しようとした
##### 背景・光や影の明るさ・色による誤認識を防ごうとした

##### OpenCV

###### 精度が低くて人間を認識できない

##### Rembg

######　背景を消す処理に7~10秒かかるため、リアルタイムで使えない
###### 画像サイズを小さくしても処理時間は変わらない。
###### むしろサイズ変更の処理分時間がかかる。

##### PyTorch

###### そもそも正常に動作しなかった

#### 顔認識

##### 横顔・後ろ頭を認識できない。
##### 動体が映っても認識できない

#### HSVを用いた差分検知

##### BGRからHSVに変換したとき、画面に砂嵐のようなノイズが現れる。
##### ノイズを誤認識してしまい、正常に人間を検知できなくなった。

#### 振動を誤検出させないため、多重の差分検知を行う。


### LINE通知システム

#### GASに保存し、LINE MessageAPIに送ってみた

##### ネットワーク上にある画像しか送ることができなかった
##### Pythonから直接アップロードできるサーバーはなかった
##### PythonからGASに直接画像を送ることはできなかった

#### Notifyを使ってみた

##### ユーザからの入力を受け付けない代わりに、画像とタイムスタンプを送ることができた。

#### 入室中に何度も再送されないよう、フラグを作った

#### 送るデータを画像から動画にする

##### Pythonでの前例はない
##### ラズパイなら前例がある
##### 送るサイズ・送信成功率の関係から、動画より写真の方がいい。

### 声掛けシステム

#### 声掛けシステムが達成すべきこと

##### センサの内容を全てスマホに通知
##### 声掛けで高齢者に指示を行う
##### 会話で時間稼ぎを行う

#### タイミング

##### ドアノブセンサ
##### 長時間見つめているとき
##### 玄関に人がいるとき
###### 夜または深夜なら高齢者を止める。
###### それ以外の場合でも、家族に通知する

#### ロボットが尋ねること

##### 「おでかけするの？」
##### 「外に出るならＯＯさんに電話した方がいいですよ」
##### 台詞は一文
##### 明確な指示
##### 高齢者のルーティーンは破壊しない

#### 会話のための情報取得
##### 時間（年から秒まで）
##### 区分（朝/昼/夜/深夜）
##### 天気
##### 温度

#### 会話に用いる音声合成ライブラリ
##### pyttsx3

###### 声が聞き取りづらい。19才で聞き取りにくい声であれば、高齢者にとってはまったく聞こえないだろう。
###### 実行から喋るまでの速さは3秒で、リアルタイムで使えるが少し遅い。

##### VoiceVox
###### 実行から喋るまでの速さは18秒で、リアルタイムでは全く使えない。